// From
// http://google-ajax-examples.googlecode.com/svn/trunk/whereareyou/scripts/geometa.js
function prepareGeolocation(e){(e||typeof navigator.geolocation=="undefined"||navigator.geolocation.shim)&&function(){(function(){if(window.google&&google.gears)return;var e=null;if(typeof GearsFactory!="undefined")e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),e.getBuildInfo().indexOf("ie_mobile")!=-1&&e.privateSetGlobalObject(this)}catch(t){typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}if(!e)return;window.google||(google={}),google.gears||(google.gears={factory:e})})();var e=function(){var e=google.gears.factory.create("beta.geolocation"),t=function(e,t){return function(n){e(n),t.lastPosition=n}};return{shim:!0,type:"Gears",lastPosition:null,getCurrentPosition:function(n,r,i){var s=this,o=t(n,s);e.getCurrentPosition(o,r,i)},watchPosition:function(t,n,r){e.watchPosition(t,n,r)},clearWatch:function(t){e.clearWatch(t)},getPermission:function(t,n,r){e.getPermission(t,n,r)}}}(),t=function(){var e=!1,t=function(){if(!s()&&!e){e=!0;var t=document.createElement("script");t.src="http://www.google.com/jsapi?callback=_google_loader_apiLoaded",t.type="text/javascript",document.getElementsByTagName("body")[0].appendChild(t)}},n=[],r=function(e){n.push(e)},i=function(){if(s())while(n.length>0){var e=n.pop();e()}};window._google_loader_apiLoaded=function(){i()};var s=function(){return window.google&&google.loader},o=function(e){return s()?!0:(r(e),t(),!1)};return t(),{shim:!0,type:"ClientLocation",lastPosition:null,getCurrentPosition:function(e,t,n){var r=this;if(!o(function(){r.getCurrentPosition(e,t,n)}))return;if(google.loader.ClientLocation){var i=google.loader.ClientLocation,s={latitude:i.latitude,longitude:i.longitude,altitude:null,accuracy:43e3,altitudeAccuracy:null,heading:null,velocity:null,timestamp:new Date,address:{city:i.address.city,country:i.address.country,country_code:i.address.country_code,region:i.address.region}};e(s),this.lastPosition=s}else t==="function"&&t({code:3,message:"Using the Google ClientLocation API and it is not able to calculate a location."})},watchPosition:function(e,t,n){this.getCurrentPosition(e,t,n);var r=this,i=setInterval(function(){r.getCurrentPosition(e,t,n)},1e4);return i},clearWatch:function(e){clearInterval(e)},getPermission:function(e,t,n){return!0}}}();navigator.geolocation=window.google&&google.gears&&google.gears.factory.create?e:t}()};