/************************************************************************
 *************************************************************************
 @Name :        jRating - jQuery Plugin
 @Revison :        3.0 (Modified by Geodirectory Team)
 @Date :        28/01/2013
 @Author:         ALPIXEL - (www.myjqueryplugins.com - www.alpixel.fr)
 @License :         Open Source - MIT License : http://www.opensource.org/licenses/mit-license.php

 **************************************************************************
 *************************************************************************/(function(e){e.fn.jRating=function(t){var n={bigStarsPath:"jquery/icons/stars.png",smallStarsPath:"jquery/icons/small.png",phpPath:"php/jRating.php",type:"big",step:!1,isDisabled:!1,showRateInfo:!0,canRateAgain:!1,length:5,decimalLength:0,rateMax:20,rateInfosX:-45,rateInfosY:5,nbRates:1,onSuccess:null,onError:null,onTouchstart:null};if(this.length>0)return this.each(function(){function y(e){var t=parseFloat(e*100/d*r.rateMax/100);switch(r.decimalLength){case 1:var n=Math.round(t*10)/10;break;case 2:var n=Math.round(t*100)/100;break;case 3:var n=Math.round(t*1e3)/1e3;break;default:var n=Math.round(t*1)/1}return n>r.rateMax&&(n=r.rateMax),n}function b(){switch(r.type){case"small":s=12,o=10,u=r.smallStarsPath;break;default:s=23,o=20,u=r.bigStarsPath}}function w(e){return e?e.offsetLeft+w(e.offsetParent):0}var r=e.extend(n,t),i=0,s=0,o=0,u="",a=!1,f=0,l=r.nbRates;if(e(this).hasClass("jDisabled")||r.isDisabled)var c=!0;else var c=!1;b(),e(this).height(o);var h=parseFloat(e(this).attr("data-average")),p=parseInt(e(this).attr("data-id")),d=s*r.length-1,v=h/r.rateMax*d,m=e("<div>",{"class":"jRatingColor",css:{width:v}}).appendTo(e(this)),h=e("<div>",{"class":"jRatingAverage",css:{width:0,top:-o}}).appendTo(e(this)),g=e("<div>",{"class":"jStar",css:{width:d,height:o,top:-(o*2),background:"url("+u+") repeat-x"}}).appendTo(e(this));v>0&&(h.width(v),m.width(0),a=!0,f=v),e(this).css({width:d,overflow:"hidden",zIndex:1,position:"relative"}),c||e(this).unbind().bind({mouseenter:function(t){var n=w(this),i=t.pageX-n;if(r.showRateInfo)var s=e("<p>",{"class":"jRatingInfos",html:y(i)+' <span class="maxRate">/ '+r.rateMax+"</span>",css:{top:t.pageY+r.rateInfosY,left:t.pageX+r.rateInfosX}}).appendTo("body").show()},mouseover:function(t){e(this).css("cursor","pointer")},mouseout:function(){e(this).css("cursor","default"),a?h.width(f):h.width(0)},mousemove:function(t){var n=w(this),o=t.pageX-n;r.step?i=Math.floor(o/s)*s+s:i=o,h.width(i),r.showRateInfo&&e("p.jRatingInfos").css({left:t.pageX+r.rateInfosX}).html(y(i)+' <span class="maxRate">/ '+r.rateMax+"</span>")},mouseleave:function(){e("p.jRatingInfos").remove()},click:function(t){var n=this;a=!0,f=i,l--,(!r.canRateAgain||parseInt(l)<=0)&&e(this).unbind().css("cursor","default").addClass("jDisabled"),r.showRateInfo&&e("p.jRatingInfos").fadeOut("fast",function(){e(this).remove()}),t.preventDefault();var s=y(i);h.width(i),e(".datasSent p").html("<strong>idBox : </strong>"+p+"<br /><strong>rate : </strong>"+s+"<br /><strong>action :</strong> rating"),e(".serverResponse p").html("<strong>Loading...</strong>"),r.onSuccess&&r.onSuccess(n,s)},touchstart:function(t){var n=this,o=w(this),u=t.originalEvent.touches[0].pageX,c=u-o;r.step?i=Math.floor(c/s)*s+s:i=c,a=!0,f=i,l--,(!r.canRateAgain||parseInt(l)<=0)&&e(this).unbind().css("cursor","default").addClass("jDisabled"),r.showRateInfo&&e("p.jRatingInfos").fadeOut("fast",function(){e(this).remove()}),t.preventDefault();var p=y(i);h.width(i),r.onTouchstart&&r.onTouchstart(n,p)}})})}})(jQuery);