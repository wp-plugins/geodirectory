function geodir_remove_file_index(e){for(var t=0;t<e.length;t++)e[t].files.length>0&&e[t].removeFile(e[t].files[0])}function plu_show_thumbs(e){var t=jQuery,n=t("#"+e+"plupload-thumbs");n.html("");var r=t("#"+e).val(),i="Remove";typeof geodir_all_js_msg.geodir_action_remove!="undefined"&&geodir_all_js_msg.geodir_action_remove!=""&&(i=geodir_all_js_msg.geodir_action_remove);var s=r.split(",");for(var o=0;o<s.length;o++)if(s[o]&&s[o]!="null"){var u=s[o].substring(s[o].lastIndexOf(".")+1),a=s[o].lastIndexOf("/")+1,f=s[o].lastIndexOf("."),l=s[o].substr(a,f<a?loc.length:f);if(u=="pdf"||u=="xlsx"||u=="xls"||u=="csv"||u=="docx"||u=="doc"||u=="txt"){l=l.split(e+"_");var c=t('<div class="thumb geodir_file" id="thumb'+e+o+'"><div class="thumbi"><a id="thumbremovelink'+e+o+'" href="#">'+i+'</a></div><a target="_blank" href="'+s[o]+'">'+l[l.length-1]+"</a></div>")}else var c=t('<div class="thumb" id="thumb'+e+o+'"><div class="thumbi"><a id="thumbremovelink'+e+o+'" href="#">'+i+'</a></div><img src="'+s[o]+'" alt=""  /></div>');n.append(c),c.find("a").click(function(){jQuery("#"+e+"plupload-upload-ui").hasClass("plupload-upload-uic-multiple")&&totalImg--,jQuery("#"+e+"upload-error").html(""),jQuery("#"+e+"upload-error").removeClass("upload-error");var n=t(this).attr("id").replace("thumbremovelink"+e,"");n=parseInt(n);var i=[];r=t("#"+e).val(),s=r.split(",");for(var o=0;o<s.length;o++)o!=n&&(i[i.length]=s[o]);return t("#"+e).val(i.join()),plu_show_thumbs(e),!1})}s.length>1&&(n.sortable({update:function(r,i){var s=[];n.find("img").each(function(){s[s.length]=t(this).attr("src"),t("#"+e).val(s.join()),plu_show_thumbs(e)})}}),n.disableSelection())}jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery(document).ready(function(e){if(e(".plupload-upload-uic").exists()){var t=!1,n="";e(".plupload-upload-uic").each(function(){var r=e(this),i=r.attr("id"),s=i.replace("plupload-upload-ui","");plu_show_thumbs(s),t=JSON.parse(gd_plupload.base_plupload_config),t.browse_button=s+t.browse_button,t.container=s+t.container,t.drop_element=s+t.drop_element,t.file_data_name=s+t.file_data_name,t.multipart_params.imgid=s,t.multipart_params._ajax_nonce=r.find(".ajaxnonceplu").attr("id").replace("ajaxnonceplu",""),r.hasClass("plupload-upload-uic-multiple")&&(t.multi_selection=!0);if(r.find(".plupload-resize").exists()){var o=parseInt(r.find(".plupload-width").attr("id").replace("plupload-width","")),u=parseInt(r.find(".plupload-height").attr("id").replace("plupload-height",""));t.resize={width:o,height:u,quality:90}}var a=new plupload.Uploader(t);a.bind("Init",function(e){}),a.init(),a.bind("Error",function(e,t){t.code==-600?(jQuery("#"+s+"upload-error").addClass("upload-error"),typeof geodir_all_js_msg.geodir_err_max_file_size!="undefined"&&geodir_all_js_msg.geodir_err_max_file_size!=""?n=geodir_all_js_msg.geodir_err_max_file_size:n="File size error : You tried to upload a file over %s",n=n.replace("%s",gd_plupload.upload_img_size),jQuery("#"+s+"upload-error").html(n)):(jQuery("#"+s+"upload-error").addClass("upload-error"),jQuery("#"+s+"upload-error").html(t.message))}),totalImg=jQuery("#"+s+"totImg").val(),limitImg=jQuery("#"+s+"image_limit").val(),a.bind("FilesAdded",function(t,i){jQuery("#"+s+"upload-error").html(""),jQuery("#"+s+"upload-error").removeClass("upload-error");if(limitImg&&r.hasClass("plupload-upload-uic-multiple")&&jQuery("#"+s+"image_limit").val()){if(totalImg==limitImg&&parseInt(limitImg)>0){while(t.files.length>0)t.removeFile(t.files[0]);return typeof geodir_all_js_msg.geodir_err_file_upload_limit!="undefined"&&geodir_all_js_msg.geodir_err_file_upload_limit!=""?n=geodir_all_js_msg.geodir_err_file_upload_limit:n="You have reached your upload limit of %s files.",n=n.replace("%s",limitImg),jQuery("#"+s+"upload-error").addClass("upload-error"),jQuery("#"+s+"upload-error").html(n),!1}if(t.files.length>limitImg&&parseInt(limitImg)>0){while(t.files.length>0)t.removeFile(t.files[0]);return typeof geodir_all_js_msg.geodir_err_pkg_upload_limit!="undefined"&&geodir_all_js_msg.geodir_err_pkg_upload_limit!=""?n=geodir_all_js_msg.geodir_err_pkg_upload_limit:n="You may only upload %s files with this package, please try again.",n=n.replace("%s",limitImg),jQuery("#"+s+"upload-error").addClass("upload-error"),jQuery("#"+s+"upload-error").html(n),!1}}e.each(i,function(e,t){r.find(".filelist").append('<div class="file" id="'+t.id+'"><b>'+t.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(t.size)+") "+'<div class="fileprogress"></div></div>')}),t.refresh(),t.start()}),a.bind("UploadProgress",function(t,n){e("#"+n.id+" .fileprogress").width(n.percent+"%"),e("#"+n.id+" span").html(plupload.formatSize(parseInt(n.size*n.percent/100)))});var f,l=0,c=new Array;a.bind("FileUploaded",function(t,n,i){c[l]=t,clearInterval(f),f=setTimeout(function(){},1e3),l++,e("#"+n.id).fadeOut(),i=i.response;if(r.hasClass("plupload-upload-uic-multiple")){totalImg++;var o=e.trim(e("#"+s).val());o?o=o+","+i:o=i,e("#"+s).val(o)}else e("#"+s).val(i+"");plu_show_thumbs(s)})})}});